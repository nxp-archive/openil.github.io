<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title></title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="pragma" content="no-cache" />
    <!-- Mobile Specific Metas  ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="../../bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../style.css" media="screen, projection" />
    <link rel="stylesheet" type="text/css" href="../../jcarousel_skin.css">
    <link rel="stylesheet" type="text/css" href="../../preloader/css/preloader.css" />
    <link rel="stylesheet" type="text/css" href="../../prettyPhoto/css/prettyPhoto.css" />
    <link rel="stylesheet" type="text/css" href="../../css/menusm.css" />
    <link rel="stylesheet" type="text/css" href="../../ui_totop/css/ui.totop.css" />
    <link rel="stylesheet" type="text/css" href="../../css/layout.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,600,700,800,300&subset=latin,cyrillic'
        rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Six+Caps' rel='stylesheet' type='text/css'>
    <style>
        iframe body {
            font-size: 14px;
        }

        a {
            color: #ef4e22;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div id="wrapper">
        <div id="header">
            <div class="navbar navbar-fixed-top">
                <div class="container">
                    <div class="navbar-inner"><a class="brand" href="/openil/index.html">OpenIL</a>
                        <div class="menu">
                            <script type="text/javascript" src="../../js/menu_html_block.js?v=0.02"></script>
                        </div>
                    </div>
                </div>
                <!--navbar-->
            </div>
        </div>

        <!-- #header-->
        <div class="clr"></div>
        <div id="content" class="nogap container">
            <div class="row">
                <div class="separator"></div>
                <h1 class="text-center extrabold" id="title">The users Archives</h1>
                <h2 class="sub-title" style="background: rgb(255, 240, 208);padding: 0 10px;font-weight:bold;">The users Archives</h2>

                <div class="row custom-content" id="mailing-lists">
                    <div class="span12">
                        <b id="messages_sorted_by" class="span12">Messages sorted by: [ subject ] [ author ] [ date ]</b>
                        <b id="result_error" class="span12"></b>

                        <b id="messages_count" class="span12"></b>
                        <table class="table">
                            <tbody>
                                <!--<tr>
                                    <th><a href="mailto:zhenhua.luo@nxp.com" style="padding-left: 2em;color:#000;">zhenhua.luo@nxp.com</a></th>
                                    <th><a href="mailto:zhenhua.luo@nxp.com" style="padding-left: 1em;">[ Thread ] </a>
                                        <a href="mailto:zhenhua.luo@nxp.com" style="padding-left: 1em;">[ Subject ] </a>
                                        <a href="mailto:zhenhua.luo@nxp.com" style="padding-left: 1em;">[ Author ] </a>
                                        <a href="mailto:zhenhua.luo@nxp.com" style="padding-left: 1em;">[ Date ]</a>
                                    </th>
                                </tr>-->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- #content-->

    </div>
    <!-- #wrapper -->

    <div id="footer">
        <div class="container">
            <div class="cols">
                <div class="row">
                    <div class="span4 offset2">
                        <h4>Stay Connected</h4>
                        <div class="post"><span>""</span>
                            <p> <a href="mailto:""">""</a><br />
                            </p>
                            <br/>
                        </div>
                    </div>
                    <!--<div class="span4">-->
                    <!-- <h4>Subscribe to our Newsletter</h4>
                        <p>Sign up to receive email notifications of news and events from OpenIl.org.</p>
                        <form id="subscribe" name="subscribe" action="#" method="post" class="validate" target="_blank">
                            <div class="input-append">
                                <input type="email" id="email" name="email" placeholder="Your Email">
                                <button class="subscribe-button btn" type="submit">SUBSCRIBE</button>
                            </div>
                        </form>
                        <div class="social">
                            <h4>follow us</h4>
                            <a class="soc1" href="#"></a> <a class="soc2" href="#"></a> <a class="soc3" href="#"></a> <a
                                class="soc4" href="#"></a> <a class="soc5" href="#"></a> <a class="soc6" href="#"></a> <a
                                class="soc7" href="#"></a> <a class="soc8" href="#"></a> <a class="soc9" href="#"></a></div>
                        <div class="clr"></div> -->
                    <!--</div>-->
                    <div class="span4">
                        <div class="lastcol">
                            <h4>Key Technologies</h4>
                            <span class="label">Linux</span>
                            <span class="label label-success">TSN</span>
                            <span class="label label-warning">IEEE 1588</span>
                            <span class="label label-important">Security</span>
                            <span class="label label-info">Xenomai</span>
                            <span class="label label-inverse">IoT</span>
                            <span class="label">Industrial</span>
                            <span class="label label-success">Real-Time</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- container cols -->
        <script type="text/javascript" src="../../js/utilities.js"></script>
        <script type="text/javascript">display_copyright()</script>
    </div>
    <!-- #footer -->



    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/jquery.jcarousel.min.js"></script>
    <script type="text/javascript" src="../../bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../prettyPhoto/js/jquery.prettyPhoto.js"></script>
    <script type="text/javascript" src="../../js/menusm.js?v=0.01"></script>
    <script type="text/javascript" src="../../js/scripts.js"></script>
    <script type="text/javascript" src="../../ui_totop/js/jquery.ui.totop.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../preloader/js/jquery.preloader.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../js/tinynav.min.js"></script>
    <script type="text/javascript">
        //get url params
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            };
        })(jQuery);
        var mailingList = $.getUrlParam('mailingList');
        console.log(mailingList)
        // mailingList = 'test@openil.org'
        var sortby = $.getUrlParam('sortby');
        console.log(sortby)
        var date = $.getUrlParam('date')
        $('#title').text('The users Archives by ' + sortby)
        var msg_sortby_html = get_msg_sortby_html(mailingList, sortby, date)
        $('#messages_sorted_by').html(msg_sortby_html)
        var url = "https://wvpkul46d8.execute-api.us-west-2.amazonaws.com/api/messages" +
            "?query=recipient:" + mailingList +
            "&fields=id,parent_id,sender,subject,original_date,date&order=desc&limit=-1&sortby="
        if(sortby == 'thread') {
            url += 'parent_id&is_sortby_thread=true'
        }else{
            url += sortby
        }
        date_arr = date.split('/')
        if(date_arr.length==2){
            var year = date_arr[0]
            var month = date_arr[1]
            url = url + '&query_date=year:' + year +',month:' + month
        }

        console.log(url)

        $.ajax({
            type: "GET",
            url: url,
            crossDomain: true,
            dataType: "json",
            success: function (res) {
                console.log(res);
                if (res == 'undefined') {
                    $("#result_error").html('Error:' + res)
                } else {
                    if (res.Code === 0) {
                        var result = res.Result
                        $('#messages_count').html('Messages: ' + res.Total)
                        for (var i in result) {
                            var msg = result[i]
//                            var index = Number(i) + 1
                            var content = "<tr>"
                            content +=   "<td"

                            if (sortby == 'thread' && msg.level != 0) {
                                console.log(msg.level)
                                content += " style= 'padding-left:" + 30 * msg.level + "px'"
                                console.log(content)
                                index=''
                            }
                            console.log(JSON.stringify(msg.sender))
                            content +=    "><li>" +
                                "<a href='archives_messages_detail.html?id=" + msg.id + "&sortby=" + sortby +"&mailinglist' style='padding-left: 0em;'> "
                            content +=    msg.subject + "</a>" +
                                " <i style='padding-left: 1em;'>" + msg.sender +  "</i>"
                            content +=    "<i style='padding-left: 1em;'>" + msg.date +  "</i>"
                            content +=    "</li></td></tr>"

                            $('#mailing-lists tbody').append( content);
                        }
                    } else {
                        $("#result_error").html('Error：<br/>' + res.Error)
                    }
                }
            },
            error: function (data, status, error) {
                console.log(data);
                console.log('fail');
            }
        });


        function get_msg_sortby_html(mailingList, sortby,date) {
            var url = "archives_messages.html?mailingList=" + mailingList + '&date=' + date + "&sortby="

            var url_thread = url + "thread"
            var url_subject = url + "subject"
            var url_author = url + "sender"
            var url_date = url + "date"
            var html = "Messages sorted by: "
            var sortby_dict = {
                "thread": "thread",
                "subject": "subject",
                "author": "sender",
                "date": "date"
            }
            console.log(sortby_dict)
            if (sortby !== sortby_dict['thread']) {
                html += "<a href='" + url_thread + "' style='padding-left: 1em;'>" + "[ Thread ] " + "</a>"
            }
            if (sortby != sortby_dict['subject']) {
                html += "<a href='" + url_subject + "' style='padding-left: 1em;'>" + "[ Subject ] " + "</a>"
            }
            if (sortby != sortby_dict['author']) {
                html += "<a href='" + url_author + "' style='padding-left: 1em;'>" + "[ Author ] " + "</a>"
            }
            if (sortby != sortby_dict['date']) {
                html += "<a href='" + url_date + "' style='padding-left: 1em;'>" + "[ Date ]" + "</a>"
            }

            return html
        }
    </script>
</body>

</html>
